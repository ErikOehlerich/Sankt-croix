<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaflet Kort med Excel Integration</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-draw/dist/leaflet.draw.css" />
    
    <!-- XLSX.js for reading Excel files -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>

    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        #map {
            height: 600px;  /* Kortets højde */
            width: 100%;  /* Kortets bredde */
            position: relative;
        }
        h1 {
            text-align: center;
            margin-top: 20px;
        }
        #footer {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background-color: #fff;
            padding: 5px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }
        .popup-content {
            max-width: 400px; /* Maksimal bredde af popuppen */
            overflow: auto; /* Tillad scrolling, hvis indholdet er for stort */
        }
        .excel-table {
            max-height: 300px; /* Sætter maksimal højde på Excel-tabellen */
            overflow-y: auto; /* Tillader lodret scrolling */
            margin-top: 10px; /* Margin for lidt afstand fra billedet */
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        /* Værktøjsboks stil */
        .tools-container {
            position: fixed; /* Flyt værktøjsboksen til fixed position */
            bottom: 20px; /* Placering til venstre */
            left: 10%; /* Placering til venstre */
            background-color: white;
            padding: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            z-index: 1000; /* Højere end kortet */
        }
        .tools-container.measure {
            left: 10%;
        }
        .tools-container.coordinates {
            left: 55%; /* Skift til højre for koordinatværktøjet */
        }
    </style>
</head>
<body>
    <h1>Sanct Croix Anno 1799</h1>
    <div id="map"></div>
    <div id="footer">Lavet af Erik Luis Lanuza Oehlerich</div>
    
    <!-- Værktøjer -->
    <div class="tools-container measure">
        <h3>Måleværktøj</h3>
        <button id="measureBtn">Aktiver Måleværktøj</button>
        <button id="stopMeasureBtn" style="display:none;">Deaktiver Måleværktøj</button>
    </div>
    
    <div class="tools-container coordinates">
        <h3>Kordinat Vælger</h3>
        <button id="coordinateBtn">Aktiver Kordinat Vælger</button>
        <button id="stopCoordinateBtn" style="display:none;">Deaktiver Kordinat Vælger</button>
    </div>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-draw/dist/leaflet.draw.js"></script>

    <script>
        // Initialiser kortet
        var map = L.map('map').setView([17.7421648, -64.7560983], 12); // Centrer kortet

        // Definer baggrundskortene
        var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            maxZoom: 19
        });

        var googleSat = L.tileLayer('https://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
            attribution: '© Google',
            subdomains: ['mt0', 'mt1', 'mt2', 'mt3'],
            maxZoom: 20
        });

        var googleStreets = L.tileLayer('https://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}', {
            attribution: '© Google',
            subdomains: ['mt0', 'mt1', 'mt2', 'mt3'],
            maxZoom: 20
        });

        var mapbox = L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=your.mapbox.access.token', {
            attribution: '© <a href="https://www.mapbox.com/about/maps/">Mapbox</a>',
            id: 'mapbox/streets-v11',
            tileSize: 512,
            zoomOffset: -1,
            maxZoom: 20
        });

        // Definer dine tile layers som overlay
        var customTiles = L.tileLayer('https://storage.googleapis.com/sanct_croix1799/{z}/{x}/{y}.png', {
            attribution: '© Google Cloud',
            maxZoom: 19
        });

        // Tilføj baggrundskort som basislag
        var baseLayers = {
            "OpenStreetMap": osm,
            "Google Satellite": googleSat,
            "Google Streets": googleStreets,
            "Mapbox Streets": mapbox
        };

        // Tilføj custom tiles som overlay og slå det til som standard
        var overlays = {
            "Custom Tiles": customTiles
        };

        // Tilføj baseLayers og overlays til kortet
        L.control.layers(baseLayers, overlays).addTo(map);

        // Tilføj OSM som standard baggrundskort
        osm.addTo(map);
        customTiles.addTo(map);

        // Markør med billede og Excel fil link
        var coordinates = [17.7078539, -64.7131291]; // Indsæt dine koordinater her
        var image = 'Point39/39.jpg'; // Korrekt sti til billede
        var excelLink = 'Point39/2_table_39.xlsx'; // Korrekt sti til Excel-fil

        // Opret en markør
        var marker = L.circleMarker(coordinates, {
            radius: 8,
            color: '#ff7800',
            weight: 1,
            opacity: 1,
            fillOpacity: 0.8
        }).bindPopup(`
            <div class="popup-content">
                <strong>Navn: Diamond Sted nr. 31 Company quarter</strong><br>
                <img src="${image}" alt="Billede" style="width:200px;height:auto;"><br>
                <button onclick="openFullscreen('${image}')">Vis i Fuldskærm</button><br>
                <button onclick="readExcel('${excelLink}')">Læs Excel fil</button>
                <button onclick="showExcelFullscreen()">Vis Excel i Fuldskærm</button>
                <div class="excel-table" id="excelContent"></div> <!-- Placeholder for Excel content -->
            </div>
        `, { className: 'popup-large' }).addTo(map); // Tilføj markøren til kortet

        // Funktion til at åbne billedet i fuldskærm
        function openFullscreen(imgSrc) {
            const img = document.createElement('img');
            img.src = imgSrc;
            img.style.width = '100%';
            img.style.height = '100%';
            img.style.objectFit = 'contain'; // Beholder billedets proportioner
            img.style.position = 'fixed';
            img.style.top = '0';
            img.style.left = '0';
            img.style.zIndex = '10000'; // Sørg for, at billedet er oven på alt
            img.onclick = function() {
                document.body.removeChild(img); // Luk billedet ved at klikke
            };
            document.body.appendChild(img); // Tilføj billedet til body
        }

        // Funktion til at læse Excel fil
        function readExcel(file) {
            fetch(file)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Netværksfejl: ' + response.statusText);
                    }
                    return response.arrayBuffer(); // Brug arrayBuffer i stedet for blob
                })
                .then(data => {
                    var workbook = XLSX.read(data, { type: 'array' });
                    var firstSheetName = workbook.SheetNames[0];
                    var worksheet = workbook.Sheets[firstSheetName];
                    var html = XLSX.utils.sheet_to_html(worksheet);
                    document.getElementById('excelContent').innerHTML = html;
                })
                .catch(error => {
                    console.error('Fejl ved indlæsning af Excel fil:', error);
                    alert('Der opstod en fejl ved indlæsning af Excel filen. Kontroller filens format og indhold.');
                });
        }

        // Funktion til at vise Excel i fuldskærm
        function showExcelFullscreen() {
            const excelContent = document.getElementById('excelContent');
            if (excelContent.innerHTML) {
                const excelPopup = document.createElement('div');
                excelPopup.innerHTML = excelContent.innerHTML; // Kopier indholdet
                excelPopup.style.position = 'fixed';
                excelPopup.style.top = '0';
                excelPopup.style.left = '0';
                excelPopup.style.width = '100%';
                excelPopup.style.height = '100%';
                excelPopup.style.backgroundColor = 'rgba(255, 255, 255, 0.9)';
                excelPopup.style.overflow = 'auto'; // Tillader scrolling
                excelPopup.style.zIndex = '10000';
                excelPopup.onclick = function() {
                    document.body.removeChild(excelPopup); // Luk Excel-vinduet ved klik
                };
                document.body.appendChild(excelPopup);
            } else {
                alert('Ingen Excel-data til at vise.');
            }
        }

        // Måleværktøj
        var drawnItems = new L.FeatureGroup();
        map.addLayer(drawnItems);

        var drawControl = new L.Control.Draw({
            edit: {
                featureGroup: drawnItems
            },
            draw: {
                polygon: false,
                circle: false,
                rectangle: false,
                marker: false
            }
        });

        map.addControl(drawControl);

        // Aktivér måleværktøj
        document.getElementById('measureBtn').onclick = function() {
            map.addControl(drawControl);
            document.getElementById('measureBtn').style.display = 'none';
            document.getElementById('stopMeasureBtn').style.display = 'block';
        };

        // Stop måleværktøj
        document.getElementById('stopMeasureBtn').onclick = function() {
            map.removeControl(drawControl);
            document.getElementById('measureBtn').style.display = 'block';
            document.getElementById('stopMeasureBtn').style.display = 'none';
        };

        // Koordinatværktøj
        var coordinatesDrawnItems = new L.FeatureGroup();
        map.addLayer(coordinatesDrawnItems);

        var coordinateControl = new L.Control.Draw({
            edit: {
                featureGroup: coordinatesDrawnItems
            },
            draw: {
                polygon: false,
                circle: false,
                rectangle: false,
                marker: true // Aktiverer marker værktøj
            }
        });

        // Aktivér koordinat værktøj
        document.getElementById('coordinateBtn').onclick = function() {
            map.addControl(coordinateControl);
            document.getElementById('coordinateBtn').style.display = 'none';
            document.getElementById('stopCoordinateBtn').style.display = 'block';
        };

        // Stop koordinat værktøj
        document.getElementById('stopCoordinateBtn').onclick = function() {
            map.removeControl(coordinateControl);
            document.getElementById('coordinateBtn').style.display = 'block';
            document.getElementById('stopCoordinateBtn').style.display = 'none';
        };

        // Ved tegning af en markør
        map.on(L.Draw.Event.CREATED, function(event) {
            var layer = event.layer;
            coordinatesDrawnItems.addLayer(layer);

            // Få koordinaterne
            var coords = layer.getLatLng();
            alert('Koordinater: ' + coords.lat + ', ' + coords.lng);
        });
    </script>
</body>
</html>
